@using CampaignManager.Web.Components.Features.Spells.Model
@using CampaignManager.Web.Components.Shared
@namespace CampaignManager.Web.Components.Features.Spells.Components

<tr class="@(IsExpanded ? "bg-gray-50" : "hover:bg-gray-50") transition-colors cursor-pointer"
    @onclick="ToggleExpand">
    <td class="px-4 py-3 font-medium text-gray-900">@Spell.Name</td>
    <td class="px-4 py-3">
        @if (!string.IsNullOrWhiteSpace(Spell.SpellType))
        {
            <Badge Variant="primary" Size="sm" Rounded="md" WithBorder="false">
                @Spell.SpellType
            </Badge>
        }
        else
        {
            <span class="text-gray-400 text-xs">—</span>
        }
    </td>
    <td class="px-4 py-3 text-gray-700">@(!string.IsNullOrWhiteSpace(Spell.Cost) ? Spell.Cost : "—")</td>
    <td class="px-4 py-3 text-gray-700">@(!string.IsNullOrWhiteSpace(Spell.CastingTime) ? Spell.CastingTime : "—")</td>
    <td class="px-4 py-3 text-center" @onclick:stopPropagation="true">
        <div class="flex gap-1 justify-center">
            <Button OnClick="() => OnEdit.InvokeAsync(Spell)"
                    Variant="outline-primary"
                    Size="sm"
                    Icon="fa-edit"
                    AdditionalClasses="text-xs shadow-none border-0">
                Изменить
            </Button>
            <Button OnClick="() => OnDelete.InvokeAsync(Spell)"
                    Variant="outline-error"
                    Size="sm"
                    Icon="fa-trash-alt"
                    AdditionalClasses="text-xs shadow-none border-0">
                Удалить
            </Button>
        </div>
    </td>
</tr>

@if (IsExpanded)
{
    <tr class="bg-gray-50">
        <td colspan="5" class="px-4 py-4">
            <div class="bg-white rounded-lg p-4 border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-2">Подробная информация</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Название:</h5>
                        <p class="text-gray-600">@Spell.Name</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Тип:</h5>
                        <p class="text-gray-600">@Spell.SpellType</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Стоимость:</h5>
                        <p class="text-gray-600">@(!string.IsNullOrWhiteSpace(Spell.Cost) ? Spell.Cost : "—")</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Время сотворения:</h5>
                        <p class="text-gray-600">@(!string.IsNullOrWhiteSpace(Spell.CastingTime) ? Spell.CastingTime : "—")</p>
                    </div>
                </div>

                @if (Spell.AlternativeNames.Count > 0)
                {
                    <div class="mt-4">
                        <h5 class="font-medium text-gray-700 mb-1">Альтернативные названия:</h5>
                        <div class="flex flex-wrap gap-2">
                            @foreach (var altName in Spell.AlternativeNames)
                            {
                                <Badge Variant="secondary" Size="sm" Rounded="md" WithBorder="false">
                                    @altName
                                </Badge>
                            }
                        </div>
                    </div>
                }

                @if (!string.IsNullOrWhiteSpace(Spell.Description))
                {
                    <div class="mt-4">
                        <h5 class="font-medium text-gray-700 mb-1">Описание:</h5>
                        <p class="text-gray-600 whitespace-pre-wrap">@Spell.Description</p>
                    </div>
                }
            </div>
        </td>
    </tr>
}

@code {
    [Parameter] public Spell Spell { get; set; } = new() { Name = string.Empty, SpellType = string.Empty };
    [Parameter] public bool IsExpanded { get; set; }
    [Parameter] public EventCallback<Spell> OnEdit { get; set; }
    [Parameter] public EventCallback<Spell> OnDelete { get; set; }
    [Parameter] public EventCallback OnToggleExpand { get; set; }

    private Task ToggleExpand()
    {
        return OnToggleExpand.InvokeAsync();
    }
}
