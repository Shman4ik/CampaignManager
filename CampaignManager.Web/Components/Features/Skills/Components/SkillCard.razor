@using CampaignManager.Web.Components.Features.Skills.Model
@using CampaignManager.Web.Extensions
@inject NavigationManager NavigationManager

<div class="bg-white shadow-md rounded-lg overflow-hidden hover:shadow-lg transition-shadow duration-300">
    <div class="p-6">
        <div class="flex justify-between items-start mb-2">
            <h2 class="text-xl font-semibold">@Skill.Name</h2>
            <div class="flex space-x-1">
                <Button OnClick="() => EditSkill(Skill)"
                        Variant="secondary"
                        Size="sm"
                        Icon="fa-edit"
                        AdditionalClasses="!p-1 !min-h-0" />
                <Button OnClick="() => OnDelete.InvokeAsync(Skill)"
                        Variant="error"
                        Size="sm"
                        Icon="fa-trash"
                        AdditionalClasses="!p-1 !min-h-0" />
            </div>
        </div>

        <div class="text-sm text-gray-600 mb-3 flex items-center space-x-4">
            <Badge Variant="info" Size="sm" Rounded="full" WithBorder="false">
                @Skill.Category.ToRussianString()
            </Badge>
            <span class="text-gray-700 font-medium">
                Базовое значение: @Skill.BaseValue%
            </span>
            @if (Skill.IsUncommon)
            {
                <Badge Variant="warning" Size="sm" Rounded="full" WithBorder="false">
                    Необычный
                </Badge>
            }
        </div>

        <!-- Описание навыка -->
        <div class="mb-4">
            <h3 class="font-medium mb-1 text-sm font-semibold">Описание:</h3>
            <div class="text-sm text-gray-700">
                @(string.IsNullOrEmpty(Skill.Description)
                    ? "Описание отсутствует."
                    : Skill.Description)
            </div>
        </div>

        <!-- Время выполнения и повтор -->
        @if (!string.IsNullOrEmpty(Skill.TimeRequired) || Skill.CanRetry)
        {
            <div class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                @if (!string.IsNullOrEmpty(Skill.TimeRequired))
                {
                    <div>
                        <span class="font-semibold text-gray-600">Время выполнения:</span>
                        <span class="text-gray-700">@Skill.TimeRequired</span>
                    </div>
                }
                <div>
                    <span class="font-semibold text-gray-600">Повтор:</span>
                    <span class="text-gray-700">@(Skill.CanRetry ? "Возможен" : "Невозможен")</span>
                </div>
            </div>
        }

        <!-- Примеры использования -->
        @if (Skill.UsageExamples.Count > 0)
        {
            <div class="mb-4">
                <h3 class="font-medium mb-1 text-sm font-semibold">Примеры использования:</h3>
                <div class="text-sm text-gray-700">
                    <ul class="list-disc list-inside space-y-1">
                        @foreach (var example in Skill.UsageExamples.Take(3))
                        {
                            <li>@example</li>
                        }
                        @if (Skill.UsageExamples.Count > 3)
                        {
                            <li class="text-gray-500">... и ещё @(Skill.UsageExamples.Count - 3)</li>
                        }
                    </ul>
                </div>
            </div>
        }

        <!-- Последствия провала -->
        @if (Skill.FailureConsequences.Count > 0)
        {
            <div class="mb-4">
                <h3 class="font-medium mb-1 text-sm font-semibold">Последствия провала:</h3>
                <div class="text-sm text-gray-700">
                    <ul class="list-disc list-inside space-y-1">
                        @foreach (var consequence in Skill.FailureConsequences.Take(2))
                        {
                            <li>@consequence</li>
                        }
                        @if (Skill.FailureConsequences.Count > 2)
                        {
                            <li class="text-gray-500">... и ещё @(Skill.FailureConsequences.Count - 2)</li>
                        }
                    </ul>
                </div>
            </div>
        }

        <!-- Противоположные навыки -->
        @if (Skill.OpposingSkills.Count > 0)
        {
            <div>
                <h3 class="font-medium mb-1 text-sm font-semibold">Противоположные навыки:</h3>
                <div class="text-sm text-gray-700">
                    @string.Join(", ", Skill.OpposingSkills)
                </div>
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public required SkillModel Skill { get; set; }
    [Parameter] public EventCallback<SkillModel> OnDelete { get; set; }

    private void EditSkill(SkillModel skill)
    {
        NavigationManager.NavigateTo($"/skills/edit/{skill.Id}");
    }

}
