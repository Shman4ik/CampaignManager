@using CampaignManager.Web.Components.Features.Combat.Model
@using CampaignManager.Web.Components.Features.Combat.Services

<div class="bg-white rounded-md shadow-sm border border-gray-200 p-4 h-full">
    <h3 class="text-lg font-semibold text-gray-900 mb-3">Боевой журнал</h3>

    <div class="max-h-[60vh] overflow-y-auto space-y-2 pr-1">
        @if (LogEntries.Count == 0)
        {
            <p class="text-sm text-gray-400 text-center py-4">Журнал пуст</p>
        }
        else
        {
            @foreach (var entry in LogEntries)
            {
                <div class="border-l-4 @GetBorderColor(entry) bg-gray-50 rounded-r-md p-3">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="inline-block bg-primary-100 text-primary-800 text-xs font-medium rounded px-1.5 py-0.5">
                            Р.@entry.Round
                        </span>
                        <span class="text-xs text-gray-400">@entry.Timestamp.ToString("HH:mm:ss")</span>
                    </div>
                    <p class="text-sm text-gray-700 leading-snug">@entry.Summary</p>
                </div>
            }
        }
    </div>
</div>

@code {
    [Parameter] public List<CombatActionResult> LogEntries { get; set; } = [];

    private static string GetBorderColor(CombatActionResult entry)
    {
        if (entry.ActionType == CombatActionType.SanityCheck)
            return "border-l-purple-500";

        return entry.AttackerWins ? "border-l-green-500" : "border-l-red-400";
    }
}
