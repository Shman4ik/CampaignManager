@using CampaignManager.Web.Components.Features.Chase.Model

<div class="bg-white rounded-md shadow-sm border border-gray-200 p-4">
    <h3 class="text-sm font-semibold text-gray-800 mb-3">–¢—Ä–∞—Å—Å–∞ –ø–æ–≥–æ–Ω–∏</h3>

    @if (Locations.Count == 0)
    {
        <p class="text-sm text-gray-400 text-center py-4">–¢—Ä–∞—Å—Å–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞</p>
    }
    else
    {
        <div class="overflow-x-auto pb-2">
            <div class="flex gap-1 min-w-max">
                @foreach (var location in Locations)
                {
                    var occupants = Participants.Where(p => p.CurrentLocation == location.Number && p.IsActive).ToList();
                    var isActiveLocation = ActiveParticipantId.HasValue &&
                        Participants.Any(p => p.Id == ActiveParticipantId && p.CurrentLocation == location.Number);

                    <div @key="location.Number" class="flex flex-col items-center gap-1 min-w-[60px]">
                        <!-- –ù–æ–º–µ—Ä –ª–æ–∫–∞—Ü–∏–∏ -->
                        <span class="text-xs text-gray-400 font-mono">@location.Number</span>

                        <!-- –Ø—á–µ–π–∫–∞ –ª–æ–∫–∞—Ü–∏–∏ -->
                        <div class="w-14 h-14 rounded-md border-2 flex flex-col items-center justify-center gap-0.5 transition-all
                                    @(isActiveLocation ? "border-blue-500 bg-blue-50" : "border-gray-200 bg-gray-50")">
                            <!-- –ò–∫–æ–Ω–∫–∏ –±–∞—Ä—å–µ—Ä–æ–≤/–æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π -->
                            <div class="flex gap-0.5">
                                @if (location.HasBarrier)
                                {
                                    <span class="text-xs" title="@($"–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ: {location.BarrierName}")">üöß</span>
                                }
                                @if (location.HasHazard)
                                {
                                    <span class="text-xs" title="@($"–û–ø–∞—Å–Ω–æ—Å—Ç—å: {location.HazardName}")">‚ö°</span>
                                }
                            </div>

                            <!-- –¢–æ–∫–µ–Ω—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
                            <div class="flex flex-wrap gap-0.5 justify-center">
                                @foreach (var occupant in occupants)
                                {
                                    <div class="w-5 h-5 rounded-full flex items-center justify-center text-white text-[9px] font-bold
                                                @(occupant.Role == ChaseRole.Prey ? "bg-green-500" : "bg-red-500")"
                                         title="@occupant.Name">
                                        @(occupant.Name.Length > 0 ? occupant.Name[0].ToString().ToUpper() : "?")
                                    </div>
                                }
                            </div>
                        </div>

                        <!-- –õ–∏–Ω–∏—è —Å–≤—è–∑–∏ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π) -->
                        @if (location.Number < Locations.Count)
                        {
                            <div class="w-full h-0.5 bg-gray-200 -mt-8 -mb-8 z-[-1]"></div>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
        <div class="flex gap-4 mt-2 text-xs text-gray-500">
            <div class="flex items-center gap-1">
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                <span>–ñ–µ—Ä—Ç–≤–∞</span>
            </div>
            <div class="flex items-center gap-1">
                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                <span>–ü—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å</span>
            </div>
            <div class="flex items-center gap-1">
                <span>üöß</span>
                <span>–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ</span>
            </div>
            <div class="flex items-center gap-1">
                <span>‚ö°</span>
                <span>–û–ø–∞—Å–Ω–æ—Å—Ç—å</span>
            </div>
        </div>
    }
</div>

@code {
    [Parameter] public List<ChaseLocation> Locations { get; set; } = [];
    [Parameter] public List<ChaseParticipant> Participants { get; set; } = [];
    [Parameter] public Guid? ActiveParticipantId { get; set; }
}
