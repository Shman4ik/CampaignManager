@using CampaignManager.Web.Components.Features.Weapons.Model
@using CampaignManager.Web.Components.Shared
@using CampaignManager.Web.Extensions
@namespace CampaignManager.Web.Components.Features.Weapons.Components

<tr class="@(IsExpanded ? "bg-gray-50" : "hover:bg-gray-50") transition-colors cursor-pointer"
    @onclick="ToggleExpand">
    <td class="px-4 py-3 font-medium text-gray-900">@Weapon.Name</td>
    <td class="px-4 py-3">
        <Badge Variant="primary" Size="sm" Rounded="md" WithBorder="false">
            @Weapon.Type.ToRussianString()
        </Badge>
    </td>
    <td class="px-4 py-3 text-gray-700">@Weapon.Skill</td>
    <td class="px-4 py-3 text-gray-700">@Weapon.Damage</td>
    <td class="px-4 py-3">
        <div class="flex flex-wrap gap-2">
            @if (Weapon.Is1920)
            {
                <Badge Variant="secondary" Size="sm" Rounded="md" WithBorder="false">
                    1920s
                </Badge>
            }
            @if (Weapon.IsModern)
            {
                <Badge Variant="secondary" Size="sm" Rounded="md" WithBorder="false">
                    Modern
                </Badge>
            }
        </div>
    </td>
    <td class="px-4 py-3 text-gray-600">
        <div class="text-sm space-y-1">
            <div class="flex gap-2">
                <span class="font-medium text-gray-700">Дист:</span>
                <span>@Weapon.Range</span>
            </div>
            <div class="flex gap-2">
                <span class="font-medium text-gray-700">Атаки:</span>
                <span>@Weapon.Attacks</span>
            </div>
            @if (!string.IsNullOrEmpty(Weapon.Cost))
            {
                <div class="flex gap-2">
                    <span class="font-medium text-gray-700">Цена:</span>
                    <span>@Weapon.Cost</span>
                </div>
            }
        </div>
    </td>
    <td class="px-4 py-3 text-center" @onclick:stopPropagation="true">
        <div class="flex gap-1 justify-center">
            <Button OnClick="() => OnEdit.InvokeAsync(Weapon)"
                    Variant="outline-primary"
                    Size="sm"
                    Icon="fa-edit"
                    AdditionalClasses="text-xs shadow-none border-0">
                Изменить
            </Button>
            <Button OnClick="() => OnDelete.InvokeAsync(Weapon)"
                    Variant="outline-error"
                    Size="sm"
                    Icon="fa-trash-alt"
                    AdditionalClasses="text-xs shadow-none border-0">
                Удалить
            </Button>
        </div>
    </td>
</tr>

@if (IsExpanded)
{
    <tr class="bg-gray-50">
        <td colspan="7" class="px-4 py-4">
            <div class="bg-white rounded-lg p-4 border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-2">Подробная информация</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Название:</h5>
                        <p class="text-gray-600">@Weapon.Name</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Тип:</h5>
                        <p class="text-gray-600">@Weapon.Type.ToRussianString()</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Навык:</h5>
                        <p class="text-gray-600">@Weapon.Skill</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Урон:</h5>
                        <p class="text-gray-600">@Weapon.Damage</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Дальность:</h5>
                        <p class="text-gray-600">@Weapon.Range</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Атаки:</h5>
                        <p class="text-gray-600">@Weapon.Attacks</p>
                    </div>
                    @if (!string.IsNullOrEmpty(Weapon.Cost))
                    {
                        <div>
                            <h5 class="font-medium text-gray-700 mb-1">Стоимость:</h5>
                            <p class="text-gray-600">@Weapon.Cost</p>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Weapon.Ammo))
                    {
                        <div>
                            <h5 class="font-medium text-gray-700 mb-1">Боеприпасы:</h5>
                            <p class="text-gray-600">@Weapon.Ammo</p>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Weapon.Malfunction))
                    {
                        <div>
                            <h5 class="font-medium text-gray-700 mb-1">Осечка:</h5>
                            <p class="text-gray-600">@Weapon.Malfunction</p>
                        </div>
                    }
                    <div>
                        <h5 class="font-medium text-gray-700 mb-1">Эпоха:</h5>
                        <div class="flex flex-wrap gap-2">
                            @if (Weapon.Is1920)
                            {
                                <Badge Variant="secondary" Size="sm" Rounded="md" WithBorder="false">
                                    1920s
                                </Badge>
                            }
                            @if (Weapon.IsModern)
                            {
                                <Badge Variant="secondary" Size="sm" Rounded="md" WithBorder="false">
                                    Modern
                                </Badge>
                            }
                        </div>
                    </div>
                </div>
                @if (!string.IsNullOrEmpty(Weapon.Notes))
                {
                    <div class="mt-4">
                        <h5 class="font-medium text-gray-700 mb-1">Примечания:</h5>
                        <p class="text-gray-600 whitespace-pre-wrap">@Weapon.Notes</p>
                    </div>
                }
            </div>
        </td>
    </tr>
}

@code {
    [Parameter] public Weapon Weapon { get; set; } = new();
    [Parameter] public bool IsExpanded { get; set; }
    [Parameter] public EventCallback<Weapon> OnEdit { get; set; }
    [Parameter] public EventCallback<Weapon> OnDelete { get; set; }
    [Parameter] public EventCallback OnToggleExpand { get; set; }

    private async Task ToggleExpand()
    {
        await OnToggleExpand.InvokeAsync();
    }
}
